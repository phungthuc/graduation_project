# MULTIPLAYER ARCHITECTURE - VISUAL DIAGRAM

## ğŸ—ï¸ KIáº¾N TRÃšC Tá»”NG QUAN

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THE TUNNEL MULTIPLAYER                      â”‚
â”‚                        (Unity NGO Client-Server)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            CLIENT SIDE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Scene_Play    â”‚      â”‚ dungeon_gameplayâ”‚      â”‚    Lobby     â”‚ â”‚
â”‚  â”‚    (Defense)    â”‚      â”‚   (Dungeon)     â”‚      â”‚   (Menu)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                         â”‚                       â”‚        â”‚
â”‚           â–¼                         â–¼                       â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              NETWORK MANAGER (Client)                           â”‚ â”‚
â”‚  â”‚  â€¢ Connection Management                                        â”‚ â”‚
â”‚  â”‚  â€¢ RPC Handler                                                  â”‚ â”‚
â”‚  â”‚  â€¢ State Synchronization                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Network Messages (UDP/TCP Hybrid)
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â–¼                                    SERVER SIDE            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              NETWORK MANAGER (Server)                           â”‚ â”‚
â”‚  â”‚  â€¢ Authority Management                                         â”‚ â”‚
â”‚  â”‚  â€¢ Game Logic Validation                                        â”‚ â”‚
â”‚  â”‚  â€¢ State Distribution                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                GAME SESSION MANAGER                             â”‚ â”‚
â”‚  â”‚  â€¢ Max Players: 4                                               â”‚ â”‚
â”‚  â”‚  â€¢ Room State: Lobby/Defense/Dungeon                           â”‚ â”‚
â”‚  â”‚  â€¢ Player List Management                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTHORITATIVE GAME LOGIC                       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Defense Mode â”‚    â”‚ Dungeon Mode  â”‚    â”‚    Player Mgr     â”‚   â”‚
â”‚  â”‚  Authority    â”‚    â”‚  Authority    â”‚    â”‚                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚  â€¢ Spawn Players  â”‚   â”‚
â”‚  â”‚â€¢Wave Spawn    â”‚    â”‚â€¢Dungeon Load  â”‚    â”‚  â€¢ Track Players â”‚   â”‚
â”‚  â”‚â€¢Castle HP     â”‚    â”‚â€¢Zone Spawn    â”‚    â”‚  â€¢ Disconnect    â”‚   â”‚
â”‚  â”‚â€¢Enemy Death   â”‚    â”‚â€¢Boss Events   â”‚    â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Enemy Mgr   â”‚    â”‚   Castle Mgr  â”‚    â”‚  GOAP AI Mgr     â”‚   â”‚
â”‚  â”‚              â”‚    â”‚               â”‚    â”‚                  â”‚   â”‚
â”‚  â”‚â€¢Spawn Auth   â”‚    â”‚â€¢HP Tracking   â”‚    â”‚â€¢AI Authority     â”‚   â”‚
â”‚  â”‚â€¢Position Syncâ”‚    â”‚â€¢Death Event   â”‚    â”‚â€¢State Sync       â”‚   â”‚
â”‚  â”‚â€¢AI State     â”‚    â”‚â€¢Broadcast HP  â”‚    â”‚â€¢Behavior Sync    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ NETWORK COMMUNICATION FLOW

### Defense Mode - Wave Spawning

```
SERVER (Authority):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Player completes previous wave                          â”‚
â”‚ 2. Timer expires (5 seconds)                               â”‚
â”‚ 3. LoadDefenseLevel() called                                â”‚
â”‚    â”œâ”€â”€ Parse waveData from JSON                             â”‚
â”‚    â”œâ”€â”€ Calculate enemy count Ã— player count                 â”‚
â”‚    â””â”€â”€ Determine spawn positions                            â”‚
â”‚ 4. SpawnEnemiesServerRpc(waveData)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ ServerRpc broadcast
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ALL CLIENTS receive WaveStarted event                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Instantiate enemies (NetworkObject)                      â”‚
â”‚ 2. Apply spawn positions                                    â”‚
â”‚ 3. Register enemies in local manager                        â”‚
â”‚ 4. Update UI: "Wave X Started"                             â”‚
â”‚ 5. Players can now fight enemies                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLIENT â†’ SERVER Actions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Player shoots enemy                                         â”‚
â”‚    â†“                                                         â”‚
â”‚ RequestDamageServerRpc(enemyId, damage)                     â”‚
â”‚    â†“                                                         â”‚
â”‚ Server validates:                                           â”‚
â”‚    â”œâ”€â”€ Check if enemy exists                               â”‚
â”‚    â”œâ”€â”€ Check distance                                       â”‚
â”‚    â”œâ”€â”€ Check if enemy is alive                             â”‚
â”‚    â””â”€â”€ Apply damage                                         â”‚
â”‚    â†“                                                         â”‚
â”‚ EnemyHealth.Value -= damage                                 â”‚
â”‚    â†“                                                         â”‚
â”‚ NetworkVariable syncs to ALL clients automatically          â”‚
â”‚    â†“                                                         â”‚
â”‚ ALL clients see enemy take damage                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SERVER â†’ ALL CLIENTS Events:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enemy dies (HP <= 0)                                        â”‚
â”‚    â†“                                                         â”‚
â”‚ EnemyDeathClientRpc(enemyId)                                â”‚
â”‚    â†“                                                         â”‚
â”‚ ALL clients:                                                â”‚
â”‚    â”œâ”€â”€ Play death animation                                  â”‚
â”‚    â”œâ”€â”€ Spawn death effects                                   â”‚
â”‚    â”œâ”€â”€ Update kill counter                                  â”‚
â”‚    â””â”€â”€ Check if wave complete                               â”‚
â”‚                                                             â”‚
â”‚ IF (all enemies dead && last wave)                         â”‚
â”‚    â†“                                                         â”‚
â”‚ WaveCompleteServerRpc()                                     â”‚
â”‚    â†“                                                         â”‚
â”‚ ALL clients: Start countdown (5s)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Player Movement & Input Sync

```
CLIENT (Owner):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Player moves (WASD)                                        â”‚
â”‚    â†“                                                         â”‚
â”‚ Get Input() â†’ WASD, Mouse                                  â”‚
â”‚    â†“                                                         â”‚
â”‚ Client-Side Prediction:                                     â”‚
â”‚    â”œâ”€â”€ Move locally immediately                            â”‚
â”‚    â””â”€â”€ Smooth, responsive                                  â”‚
â”‚    â†“                                                         â”‚
â”‚ MoveServerRpc(inputVector)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ RPC call to server
                         â–¼
SERVER (Authority):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Validate input (anti-cheat)                             â”‚
â”‚    â”œâ”€â”€ Check input magnitude                               â”‚
â”‚    â”œâ”€â”€ Check movement speed limit                          â”‚
â”‚    â””â”€â”€ Check if player can move                            â”‚
â”‚ 2. Apply movement on server                                â”‚
â”‚    â”œâ”€â”€ Update NetworkTransform                             â”‚
â”‚    â”œâ”€â”€ Check collisions                                    â”‚
â”‚    â””â”€â”€ Update physics                                       â”‚
â”‚ 3. Broadcast to ALL other clients                         â”‚
â”‚    â””â”€â”€ MoveClientRpc(position, rotation)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ State sync to others
                         â–¼
CLIENT (Non-Owner):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Receive MoveClientRpc(position, rotation)                   â”‚
â”‚    â†“                                                         â”‚
â”‚ Interpolate movement:                                       â”‚
â”‚    â”œâ”€â”€ Smoothly move to new position                       â”‚
â”‚    â”œâ”€â”€ Blend rotation                                       â”‚
â”‚    â””â”€â”€ No jitter, natural                                  â”‚
â”‚    â†“                                                         â”‚
â”‚ Display other player moving smoothly                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RECONCILIATION (Owner Client):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ If server position differs from predicted:                  â”‚
â”‚    â†“                                                         â”‚
â”‚ 1. Store predicted positions (history)                     â”‚
â”‚ 2. Apply server correction                                 â”‚
â”‚ 3. Replay predicted movements from history                 â”‚
â”‚ 4. Smooth interpolation                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Castle HP Synchronization

```
SERVER (Authority):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enemy attacks castle:                                       â”‚
â”‚    â”œâ”€â”€ Enemy within range?                                  â”‚
â”‚    â”œâ”€â”€ Attack cooldown expired?                             â”‚
â”‚    â””â”€â”€ Deal damage                                          â”‚
â”‚    â†“                                                         â”‚
â”‚ Castle.TakeDamageServerRpc(damage)                          â”‚
â”‚    â†“                                                         â”‚
â”‚ NetworkVariable<int> castleHP.Value -= damage                â”‚
â”‚    â†“                                                         â”‚
â”‚ Auto-sync to ALL clients                                    â”‚
â”‚    â†“                                                         â”‚
â”‚ IF (castleHP.Value <= 0)                                    â”‚
â”‚    â”œâ”€â”€ CastleDeathServerRpc()                               â”‚
â”‚    â””â”€â”€ Start game over sequence                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚
                         â–¼
ALL CLIENTS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Castle HP updates automatically (NetworkVariable)           â”‚
â”‚    â”œâ”€â”€ Update HP bar UI                                     â”‚
â”‚    â”œâ”€â”€ Show damage effects                                  â”‚
â”‚    â””â”€â”€ Play damage sound                                    â”‚
â”‚                                                             â”‚
â”‚ IF receives CastleDeathServerRpc:                          â”‚
â”‚    â”œâ”€â”€ Show "DEFEATED" UI                                   â”‚
â”‚    â”œâ”€â”€ Stop gameplay                                        â”‚
â”‚    â””â”€â”€ Return to main menu                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ® GAME STATE FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE MACHINE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  LOBBY   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
         â”‚                   â”‚
         â”‚ Host starts       â”‚ Game Over
         â–¼                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
    â”‚   DEFENSE    â”‚         â”‚
    â”‚     MODE     â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
           â”‚                 â”‚
           â”‚ Wave complete   â”‚ Defeated
           â–¼                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
    â”‚ TRANSITION   â”‚         â”‚
    â”‚ (5s countdown)â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
           â”‚                 â”‚
           â”‚ Timer expires   â”‚
           â–¼                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
    â”‚   DUNGEON    â”‚         â”‚
    â”‚     MODE     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ All enemies killed
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    VICTORY   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Level complete
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ NEXT LEVEL   â”‚ â”€â”€â”€â”€â”€â–º Back to DEFENSE MODE
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**State Synchronization:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server Authority:                                         â”‚
â”‚  â”œâ”€â”€ Current GameState (Lobby/Defense/Dungeon)             â”‚
â”‚  â”œâ”€â”€ Current Level Index                                   â”‚
â”‚  â”œâ”€â”€ Wave Index                                            â”‚
â”‚  â””â”€â”€ Transition Triggers                                   â”‚
â”‚                                                             â”‚
â”‚  Server broadcasts state changes:                          â”‚
â”‚  â”œâ”€â”€ GameStateChangedClientRpc(newState)                   â”‚
â”‚  â””â”€â”€ All clients transition in sync                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¥ PLAYER MANAGEMENT

```
PLAYER LIFECYCLE:

Join Game:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Client clicks "Join Game"                               â”‚
â”‚ 2. Client connects to server                               â”‚
â”‚ 3. Server assigns NetworkClientId                           â”‚
â”‚ 4. Server spawns NetworkObject cho player                   â”‚
â”‚ 5. Server adds player to PlayerList                        â”‚
â”‚ 6. Server broadcasts: PlayerJoinedClientRpc(playerId)     â”‚
â”‚ 7. All other clients instantiate player visual             â”‚
â”‚ 8. New player can see all existing players                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

In-Game:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Player 1              Player 2             Player 3        â”‚
â”‚  â”œâ”€â”€ Owns Input       â”œâ”€â”€ Sees P1          â”œâ”€â”€ Sees P1    â”‚
â”‚  â”œâ”€â”€ Predicts locally â”œâ”€â”€ Interpolates     â”œâ”€â”€ Interpolatesâ”‚
â”‚  â””â”€â”€ RPCs to server    â”‚  from server       â”‚  from server  â”‚
â”‚         â”‚              â”‚         â”‚         â”‚      â”‚        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                     Server Authority                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Disconnect:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Client loses connection                                 â”‚
â”‚ 2. Server detects disconnection                            â”‚
â”‚ 3. Server:                                                â”‚
â”‚    â”œâ”€â”€ Despawn player NetworkObject                        â”‚
â”‚    â”œâ”€â”€ Remove from PlayerList                              â”‚
â”‚    â””â”€â”€ Broadcast: PlayerLeftClientRpc(playerId)           â”‚
â”‚ 4. All other clients:                                     â”‚
â”‚    â”œâ”€â”€ Remove player visual                                â”‚
â”‚    â”œâ”€â”€ Update UI                                          â”‚
â”‚    â””â”€â”€ Continue game                                       â”‚
â”‚                                                             â”‚
â”‚ IF (server disconnects):                                  â”‚
â”‚    â””â”€â”€ All clients return to main menu                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ENEMY AI SYNCHRONIZATION

```
GOAP AI + Network Synchronization:

SERVER:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enemy.RunAI()                                              â”‚
â”‚    â”œâ”€â”€ GOAP decision making                                â”‚
â”‚    â”œâ”€â”€ Select action based on state                        â”‚
â”‚    â”œâ”€â”€ Execute action (move, attack)                       â”‚
â”‚    â””â”€â”€ Update NetworkVariables (state, position)           â”‚
â”‚                                                             â”‚
â”‚ IF (state changes):                                        â”‚
â”‚    â”œâ”€â”€ NetworkVariable syncs automatically                â”‚
â”‚    â””â”€â”€ Clients receive update                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
CLIENTS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Receive state updates (NetworkVariable)                    â”‚
â”‚    â”œâ”€â”€ Update animation                                     â”‚
â”‚    â”œâ”€â”€ Update movement                                      â”‚
â”‚    â””â”€â”€ Play sounds if needed                               â”‚
â”‚                                                             â”‚
â”‚ IF receives attack state:                                  â”‚
â”‚    â”œâ”€â”€ Play attack animation                                â”‚
â”‚    â”œâ”€â”€ Spawn attack effects                                 â”‚
â”‚    â””â”€â”€ Check if player hit                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NOTE: Clients khÃ´ng cháº¡y AI logic, chá»‰ visualize.
AI chá»‰ cháº¡y trÃªn server Ä‘á»ƒ Ä‘áº£m báº£o consistency.
```

---

## ğŸ“¦ NETWORK OBJECT HIERARCHY

```
NetworkObject Spawn Hierarchy:

SERVER:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NetworkObject.Prefab                                       â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€â”€ PlayerController (NetworkObject)                     â”‚
â”‚    â”‚   â”œâ”€â”€ NetworkTransform (position/rotation)              â”‚
â”‚    â”‚   â”œâ”€â”€ NetworkHealth (HP sync)                          â”‚
â”‚    â”‚   â””â”€â”€ NetworkWeaponHandler (weapon state)              â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€â”€ Enemy (NetworkObject)                                â”‚
â”‚    â”‚   â”œâ”€â”€ NetworkTransform                                 â”‚
â”‚    â”‚   â”œâ”€â”€ NetworkHealth                                    â”‚
â”‚    â”‚   â”œâ”€â”€ NetworkState (AI state)                          â”‚
â”‚    â”‚   â””â”€â”€ NetworkBehavior (attack/move state)             â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€â”€ Castle (NetworkObject)                               â”‚
â”‚    â”‚   â”œâ”€â”€ NetworkTransform                                 â”‚
â”‚    â”‚   â””â”€â”€ NetworkCastleHP                                 â”‚
â”‚    â”‚                                                         â”‚
â”‚    â””â”€â”€ Projectile (NetworkObject)                          â”‚
â”‚        â”œâ”€â”€ NetworkTransform                                 â”‚
â”‚        â””â”€â”€ NetworkProjectileData                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLIENT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auto-spawn NetworkObjects:                                  â”‚
â”‚    â”œâ”€â”€ Instantiate visuals                                   â”‚
â”‚    â”œâ”€â”€ Apply NetworkObject references                       â”‚
â”‚    â””â”€â”€ Sync from server automatically                      â”‚
â”‚                                                             â”‚
â”‚ Each NetworkObject:                                         â”‚
â”‚    â”œâ”€â”€ Has NetworkTransform component                       â”‚
â”‚    â”œâ”€â”€ Syncs position/rotation                             â”‚
â”‚    â””â”€â”€ NetworkVariables sync state                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ COMPONENT INTEGRATION

```
EXISTING COMPONENTS â†’ NETWORK VERSION:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Current            â”‚    Network              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GameManager.cs       â”‚ NetworkGameManager.cs   â”‚
â”‚ LevelManager.cs      â”‚ NetworkLevelManager.cs  â”‚
â”‚ EnemyManager.cs     â”‚ NetworkEnemyManager.cs  â”‚
â”‚ EnemyBase.cs         â”‚ NetworkEnemyBase.cs    â”‚
â”‚ EnemyHealth.cs       â”‚ NetworkEnemyHealth.cs  â”‚
â”‚ Castle.cs            â”‚ NetworkCastle.cs       â”‚
â”‚ PlayerMovement.cs    â”‚ NetworkPlayerControllerâ”‚
â”‚ (Cowsins)            â”‚  .cs                   â”‚
â”‚ TimeCounter.cs       â”‚ NetworkTimeCounter.cs  â”‚
â”‚ TurretController.cs  â”‚ NetworkTurretCtrl.cs   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key Changes:
â”œâ”€â”€ Inherit from NetworkBehaviour instead of MonoBehaviour
â”œâ”€â”€ Add [ServerRpc] cho actions cáº§n server authority
â”œâ”€â”€ Add [ClientRpc] cho state broadcasts
â”œâ”€â”€ Wrap data in NetworkVariable<T>
â””â”€â”€ Use NetworkTransform cho movement sync
```

---

## ğŸ’¾ DATA FLOW DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLIENT A                     SERVER                    CLIENT B
                    â”‚
Input: "W" key      â”‚
    â”‚               â”‚
    â”œâ”€â”€â–º [Move]     â”‚
         ServerRpc  â”‚
                    â”‚
                    â–¼
            Validate Input
                    â”‚
                    â”œâ”€â”€â–º Update Position
                    â”‚         â”‚
                    â”‚         â”œâ”€â”€â–º Broadcast to
                    â”‚         â”‚    ALL clients
                    â”‚         â”‚         â”‚
                    â”‚         â”‚         â”‚
                    â”‚â—„â”€â”€â”€â”€ ClientRpc â”€â”€â”€â”˜
                    â”‚         â”‚
                    â–¼         â–¼
            Display Movement  Display Movement
            on Client A      on Client B
            
SAME FLOW FOR:
â”œâ”€â”€ Shooting
â”œâ”€â”€ Enemies spawning/dying
â”œâ”€â”€ Castle taking damage
â””â”€â”€ Game state transitions
```

---

## ğŸ¨ UI SYNCHRONIZATION

```
UI ELEMENTS THAT NEED SYNC:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NetworkUIHandler.cs                                        â”‚
â”‚                                                             â”‚
â”‚  â”œâ”€â”€ Game State UI:                                         â”‚
â”‚  â”‚   â”œâ”€â”€ Current wave counter (server â†’ all)               â”‚
â”‚  â”‚   â”œâ”€â”€ Timer countdown (server â†’ all)                   â”‚
â”‚  â”‚   â””â”€â”€ Win/lose screen (server â†’ all)                   â”‚
â”‚  â”‚                                                         â”‚
â”‚  â”œâ”€â”€ Player Info UI:                                       â”‚
â”‚  â”‚   â”œâ”€â”€ HP bars (auto-sync via NetworkVariable)          â”‚
â”‚  â”‚   â”œâ”€â”€ Ammo count (owner â†’ server â†’ others)            â”‚
â”‚  â”‚   â””â”€â”€ Player list (server â†’ all)                       â”‚
â”‚  â”‚                                                         â”‚
â”‚  â”œâ”€â”€ Castle UI:                                            â”‚
â”‚  â”‚   â”œâ”€â”€ HP bar (server â†’ all)                             â”‚
â”‚  â”‚   â””â”€â”€ Attack indicators (server â†’ all)                 â”‚
â”‚  â”‚                                                         â”‚
â”‚  â””â”€â”€ Enemy UI (optional):                                 â”‚
â”‚      â”œâ”€â”€ HP bars (server â†’ all)                            â”‚
â”‚      â””â”€â”€ Aggro indicators (server â†’ all)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ DEPLOYMENT ARCHITECTURE

```
Option 1: Self-Hosted (FREE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Player 1's PC (Host)                                      â”‚
â”‚  â”œâ”€â”€ Runs as Server + Client                               â”‚
â”‚  â”œâ”€â”€ Port: 7777 (forwarded)                                â”‚
â”‚  â””â”€â”€ Other players connect via IP                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option 2: Unity Relay (FREE for <100 CCU)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Unity Cloud Services                                       â”‚
â”‚  â”œâ”€â”€ Unity Relay Server                                     â”‚
â”‚  â”œâ”€â”€ NAT traversal                                          â”‚
â”‚  â”œâ”€â”€ Connection management                                  â”‚
â”‚  â””â”€â”€ No port forwarding needed                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option 3: Dedicated Server ($6/month)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPS (DigitalOcean/AWS)                                     â”‚
â”‚  â”œâ”€â”€ Headless Unity build                                   â”‚
â”‚  â”œâ”€â”€ Linux server                                           â”‚
â”‚  â”œâ”€â”€ 1GB RAM sufficient                                     â”‚
â”‚  â””â”€â”€ Runs 24/7                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

ÄÃ¢y lÃ  architectural diagrams Ä‘áº§y Ä‘á»§ cho há»‡ thá»‘ng multiplayer cá»§a "The Tunnel"!
